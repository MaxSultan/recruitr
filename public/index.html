<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitr - Athlete Management</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-medal"></i> Recruitr</h1>
                <p>Wrestling Athlete Management System</p>
            </div>
        </header>

        <!-- Controls Section -->
        <div class="controls">
            <div class="search-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search athletes by name..." />
                    <button id="searchBtn" class="btn btn-primary">Search</button>
                </div>
            </div>

            <div class="filter-section">
                <div class="filters">
                    <div class="filter-group">
                        <label for="stateFilter">State:</label>
                        <select id="stateFilter">
                            <option value="">All States</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="teamFilter">Team:</label>
                        <select id="teamFilter">
                            <option value="">All Teams</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="yearFilter">Year:</label>
                        <select id="yearFilter">
                            <option value="">All Years</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="weightClassFilter">Weight Class:</label>
                        <select id="weightClassFilter">
                            <option value="">All Weight Classes</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="divisionFilter">Division:</label>
                        <select id="divisionFilter">
                            <option value="">All Divisions</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="gradeFilter">Grade:</label>
                        <select id="gradeFilter">
                            <option value="">All Grades</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="favoritesFilter">Favorites:</label>
                        <select id="favoritesFilter">
                            <option value="">All Athletes</option>
                            <option value="favorites">Favorites Only</option>
                            <option value="non-favorites">Non-Favorites Only</option>
                        </select>
                    </div>
                    
                </div>
                
                <div class="filter-actions">
                    <button id="clearFiltersBtn" class="btn btn-secondary">Clear Filters</button>
                    <button id="mergeAthletesBtn" class="btn btn-warning">
                        <i class="fas fa-compress-arrows-alt"></i> Merge Athletes
                    </button>
                </div>
            </div>

            <div class="sort-section">
                <div class="sort-controls">
                    <label for="sortBy">Sort by:</label>
                    <select id="sortBy">
                        <option value="name">Name</option>
                        <option value="overallWinRate">Overall Win Rate</option>
                        <option value="totalWins">Total Wins</option>
                        <option value="totalSeasons">Total Seasons</option>
                        <option value="bestPlacement">Best Placement</option>
                        <option value="winRateImprovement">Win Rate Improvement</option>
                        <option value="placementImprovement">Placement Improvement</option>
                        <option value="improvementTrend">Improvement Trend</option>
                        <option value="totalPoints">Total Points</option>
                        <option value="averagePoints">Average Points</option>
                        <option value="mostRecentYear">Most Recent Year</option>
                    </select>
                    
                    <label for="sortOrder">Order:</label>
                    <select id="sortOrder">
                        <option value="asc">Ascending</option>
                        <option value="desc">Descending</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Tournament Scraper Toggle -->
        <div class="scraper-toggle-container">
            <button id="toggleScraperBtn" class="btn btn-secondary">
                <i class="fas fa-plus"></i> Add Tournament Data
            </button>
        </div>

        <!-- Tournament Scraper Section -->
        <div class="scraper-section" id="scraperSection" style="display: none;">
            <div class="scraper-header">
                <h3><i class="fas fa-download"></i> Add Tournament Data</h3>
                <p>Scrape wrestling tournament data and add it to the database</p>
            </div>
            
            <div class="scraper-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="tournamentId">Tournament ID <span class="required">*</span></label>
                        <input type="text" id="tournamentId" placeholder="e.g., 854866132" required>
                        <small class="form-help">Found in the Track Wrestling tournament URL</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="tournamentYear">Year</label>
                        <input type="number" id="tournamentYear" placeholder="2025" min="2020" max="2030">
                        <small class="form-help">Defaults to current year</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="tournamentState">State</label>
                        <input type="text" id="tournamentState" placeholder="UT" maxlength="2">
                        <small class="form-help">2-letter state code (optional)</small>
                    </div>
                    
                    <div class="form-group">
                        <button id="scrapeTournamentBtn" class="btn btn-primary">
                            <i class="fas fa-download"></i> Scrape Tournament
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Scraping Progress -->
            <div id="scrapingProgress" class="scraping-progress" style="display: none;">
                <div class="progress-header">
                    <i class="fas fa-spinner fa-spin"></i>
                    <span id="progressText">Initializing scraper...</span>
                </div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="progress-details" id="progressDetails"></div>
            </div>
            
            <!-- Scraping Results -->
            <div id="scrapingResults" class="scraping-results" style="display: none;">
                <div class="results-header">
                    <i id="resultsIcon" class="fas fa-check-circle"></i>
                    <h4 id="resultsTitle">Scraping Complete</h4>
                </div>
                <div id="resultsContent" class="results-content"></div>
                <div class="results-actions">
                    <button id="viewNewDataBtn" class="btn btn-primary">
                        <i class="fas fa-eye"></i> View New Data
                    </button>
                    <button id="scrapeAnotherBtn" class="btn btn-secondary">
                        <i class="fas fa-plus"></i> Scrape Another Tournament
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <div class="stat-info">
                    <div class="stat-number" id="totalAthletes">0</div>
                    <div class="stat-label">Total Athletes</div>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-trophy"></i>
                <div class="stat-info">
                    <div class="stat-number" id="totalSeasons">0</div>
                    <div class="stat-label">Total Seasons</div>
                </div>
            </div>
            <div class="stat-card">
                <i class="fas fa-eye"></i>
                <div class="stat-info">
                    <div class="stat-number" id="displayedAthletes">0</div>
                    <div class="stat-label">Displayed</div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section">
            <div class="results-header">
                <h2>Athletes</h2>
                <div class="view-toggle">
                    <button id="cardViewBtn" class="btn btn-small active">
                        <i class="fas fa-th-large"></i> Cards
                    </button>
                    <button id="tableViewBtn" class="btn btn-small">
                        <i class="fas fa-table"></i> Table
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading athletes...</p>
            </div>

            <!-- Error State -->
            <div id="errorState" class="error-state" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Error loading athletes. Please try again.</p>
                <button id="retryBtn" class="btn btn-primary">Retry</button>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="fas fa-search"></i>
                <p>No athletes found matching your criteria.</p>
            </div>

            <!-- Card View -->
            <div id="cardView" class="card-view">
                <!-- Athlete cards will be dynamically inserted here -->
            </div>

            <!-- Table View -->
            <div id="tableView" class="table-view" style="display: none;">
                <div class="table-container">
                    <table id="athletesTable">
                        <thead>
                            <tr>
                                <th data-sort="name">Name <i class="fas fa-sort"></i></th>
                                <th data-sort="state">State <i class="fas fa-sort"></i></th>
<th data-sort="totalSeasons">Seasons <i class="fas fa-sort"></i></th>
                                <th data-sort="overallWinRate">Overall Win Rate <i class="fas fa-sort"></i></th>
                                <th data-sort="totalWins">Total Wins <i class="fas fa-sort"></i></th>
                                <th data-sort="bestPlacement">Best Placement <i class="fas fa-sort"></i></th>
                                <th data-sort="winRateImprovement">Win Rate Trend <i class="fas fa-sort"></i></th>
                                <th data-sort="placementImprovement">Placement Trend <i class="fas fa-sort"></i></th>
                                <th data-sort="improvementTrend">Overall Trend <i class="fas fa-sort"></i></th>
                                <th data-sort="totalPoints">Total Points <i class="fas fa-sort"></i></th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="athletesTableBody">
                            <!-- Table rows will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="pagination">
                <div class="pagination-controls">
                    <button id="prevPageBtn" class="btn btn-secondary">
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    
                    <div id="paginationPages" class="pagination-pages">
                        <!-- Page number buttons will be inserted here -->
                    </div>
                    
                    <button id="nextPageBtn" class="btn btn-secondary">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div class="pagination-info">
                    <div id="pageInfo" class="page-info">Page 1 of 1</div>
                    <div class="page-size-controls">
                        <label for="pageSizeSelect">Show:</label>
                        <select id="pageSizeSelect">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                        <span>per page</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Athlete Detail Modal -->
    <div id="athleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAthleteTitle">Athlete Details</h2>
                <button id="closeModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalAthleteDetails">
                <!-- Athlete details will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Merge Athletes Modal -->
    <div id="mergeModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Merge Athletes</h2>
                <button id="closeMergeModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="merge-instructions" style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <h4 style="margin-top: 0;"><i class="fas fa-info-circle"></i> How to Merge Athletes</h4>
                    <p style="margin-bottom: 0;">Select two athletes below. The first athlete will be kept and all seasons from the second athlete will be moved to the first athlete. The second athlete will be deleted.</p>
                </div>
                
                <div class="athlete-selection" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div class="athlete-selector">
                        <h4>Keep This Athlete</h4>
                        <div class="search-container" style="margin-bottom: 1rem;">
                            <input type="text" id="keepAthleteSearch" placeholder="Search athletes to keep..." style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div id="keepAthleteList" class="athlete-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px;">
                            <!-- Athletes will be populated here -->
                        </div>
                        <div id="selectedKeepAthlete" class="selected-athlete" style="margin-top: 1rem; padding: 1rem; background: #f0f9ff; border-radius: 6px; border-left: 4px solid #3b82f6; display: none;">
                            <!-- Selected athlete info -->
                        </div>
                    </div>
                    
                    <div class="athlete-selector">
                        <h4>Merge This Athlete Into the First</h4>
                        <div class="search-container" style="margin-bottom: 1rem;">
                            <input type="text" id="mergeAthleteSearch" placeholder="Search athletes to merge..." style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div id="mergeAthleteList" class="athlete-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px;">
                            <!-- Athletes will be populated here -->
                        </div>
                        <div id="selectedMergeAthlete" class="selected-athlete" style="margin-top: 1rem; padding: 1rem; background: #fef3c7; border-radius: 6px; border-left: 4px solid #f59e0b; display: none;">
                            <!-- Selected athlete info -->
                        </div>
                    </div>
                </div>
                
                <div class="merge-actions" style="margin-top: 2rem; text-align: center;">
                    <button id="executeMergeBtn" class="btn btn-danger" disabled style="margin-right: 1rem;">
                        <i class="fas fa-compress-arrows-alt"></i> Merge Athletes
                    </button>
                    <button id="cancelMergeBtn" class="btn btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Season Management Modals -->

    <!-- Add Season Modal -->
    <div id="addSeasonModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Add New Season</h2>
                <button id="closeAddSeasonModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addSeasonForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addSeasonYear">Year *</label>
                            <input type="number" id="addSeasonYear" min="2020" max="2030" required>
                        </div>
                        <div class="form-group">
                            <label for="addSeasonWeightClass">Weight Class *</label>
                            <input type="text" id="addSeasonWeightClass" placeholder="e.g., 165" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addSeasonWins">Wins</label>
                            <input type="number" id="addSeasonWins" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="addSeasonLosses">Losses</label>
                            <input type="number" id="addSeasonLosses" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addSeasonPlacement">State Placement</label>
                            <input type="text" id="addSeasonPlacement" placeholder="e.g., 1st, 2nd, 3rd">
                        </div>
                        <div class="form-group">
                            <label for="addSeasonPoints">Points Scored</label>
                            <input type="number" id="addSeasonPoints" min="0" step="0.5" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addSeasonTeam">Team</label>
                            <input type="text" id="addSeasonTeam" placeholder="Team name">
                        </div>
                        <div class="form-group">
                            <label for="addSeasonDivision">Division</label>
                            <input type="text" id="addSeasonDivision" placeholder="e.g., 4A, 5A">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="addSeasonGrade">Grade</label>
                            <select id="addSeasonGrade">
                                <option value="">Select Grade</option>
                                <option value="Fr">Freshman (Fr)</option>
                                <option value="So">Sophomore (So)</option>
                                <option value="Jr">Junior (Jr)</option>
                                <option value="Sr">Senior (Sr)</option>
                                <option value="9th">9th Grade</option>
                                <option value="10th">10th Grade</option>
                                <option value="11th">11th Grade</option>
                                <option value="12th">12th Grade</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="addSeasonTournamentId">Tournament ID</label>
                            <input type="text" id="addSeasonTournamentId" placeholder="Optional">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Season
                        </button>
                        <button type="button" id="cancelAddSeason" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Season Modal -->
    <div id="editSeasonModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Edit Season</h2>
                <button id="closeEditSeasonModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editSeasonForm">
                    <input type="hidden" id="editSeasonId">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSeasonYear">Year *</label>
                            <input type="number" id="editSeasonYear" min="2020" max="2030" required>
                        </div>
                        <div class="form-group">
                            <label for="editSeasonWeightClass">Weight Class *</label>
                            <input type="text" id="editSeasonWeightClass" placeholder="e.g., 165" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSeasonWins">Wins</label>
                            <input type="number" id="editSeasonWins" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="editSeasonLosses">Losses</label>
                            <input type="number" id="editSeasonLosses" min="0" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSeasonPlacement">State Placement</label>
                            <input type="text" id="editSeasonPlacement" placeholder="e.g., 1st, 2nd, 3rd">
                        </div>
                        <div class="form-group">
                            <label for="editSeasonPoints">Points Scored</label>
                            <input type="number" id="editSeasonPoints" min="0" step="0.5" placeholder="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSeasonTeam">Team</label>
                            <input type="text" id="editSeasonTeam" placeholder="Team name">
                        </div>
                        <div class="form-group">
                            <label for="editSeasonDivision">Division</label>
                            <input type="text" id="editSeasonDivision" placeholder="e.g., 4A, 5A">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editSeasonGrade">Grade</label>
                            <select id="editSeasonGrade">
                                <option value="">Select Grade</option>
                                <option value="Fr">Freshman (Fr)</option>
                                <option value="So">Sophomore (So)</option>
                                <option value="Jr">Junior (Jr)</option>
                                <option value="Sr">Senior (Sr)</option>
                                <option value="9th">9th Grade</option>
                                <option value="10th">10th Grade</option>
                                <option value="11th">11th Grade</option>
                                <option value="12th">12th Grade</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editSeasonTournamentId">Tournament ID</label>
                            <input type="text" id="editSeasonTournamentId" placeholder="Optional">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button type="button" id="cancelEditSeason" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Season Confirmation Modal -->
    <div id="deleteSeasonModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Delete Season</h2>
                <button id="closeDeleteSeasonModal" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="delete-confirmation">
                    <div class="warning-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p>Are you sure you want to delete this season?</p>
                    <div id="deleteSeasonInfo" class="season-info">
                        <!-- Season info will be populated here -->
                    </div>
                    <p class="warning-text">This action cannot be undone.</p>
                </div>
                <div class="form-actions">
                    <button id="confirmDeleteSeason" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Delete Season
                    </button>
                    <button id="cancelDeleteSeason" class="btn btn-secondary">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/app.js"></script>
</body>
</html>
